// Spawn enemy units automatically
let enemyTimer = 0;
function spawnEnemyUnit() {
  const unit = {
    x: 500,
    y: 200,
    speed: -1.5,
    hp: 10,
    side: 'enemy'
  };
  units.push(unit);
}

// Game loop
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Draw towers
  ctx.fillStyle = 'blue';
  ctx.fillRect(towers.player.x-20, towers.player.y-20, 40, 40);
  ctx.fillStyle = 'red';
  ctx.fillRect(towers.enemy.x-20, towers.enemy.y-20, 40, 40);

  // Spawn enemy units every 2 seconds
  enemyTimer += 1/60; // assuming 60fps
  if(enemyTimer >= 2){
    spawnEnemyUnit();
    enemyTimer = 0;
  }

  // Move and resolve units
  units.forEach(u=>{
    ctx.fillStyle = u.side === 'player' ? 'lightblue' : 'pink';
    ctx.fillRect(u.x-10, u.y-10, 20, 20);
    u.x += u.speed;

    // Attack towers
    if(u.side==='player' && u.x >= towers.enemy.x-20){ towers.enemy.hp -= 1; u.hp=0; }
    if(u.side==='enemy' && u.x <= towers.player.x+20){ towers.player.hp -= 1; u.hp=0; }

    // Attack other units
    units.forEach(other=>{
      if(other !== u && other.side !== u.side){
        const dx = Math.abs(u.x - other.x);
        const dy = Math.abs(u.y - other.y);
        if(dx < 20 && dy < 20){ // collision
          u.hp -= 0.5;
          other.hp -= 0.5;
        }
      }
    });
  });

  // Remove dead units
  for(let i=units.length-1;i>=0;i--){
    if(units[i].hp <=0) units.splice(i,1);
  }

  // Draw HP
  ctx.fillStyle='white';
  ctx.font='16px Arial';
  ctx.fillText('Player Tower HP: '+towers.player.hp, 20, 20);
  ctx.fillText('Enemy Tower HP: '+towers.enemy.hp, 400, 20);

  requestAnimationFrame(draw);
}

draw();
